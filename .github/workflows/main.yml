name: LinkedIn Post Generator

on:
  schedule:
    # ExÃ©cution quotidienne Ã  9h UTC (10h heure franÃ§aise)
    - cron: '0 9 * * *'
  workflow_dispatch:  # DÃ©clenchement manuel
  push:
    branches: [ main ]

jobs:
  generate-post:
    runs-on: ubuntu-latest
    environment: bot-linkedin-env
    steps:
    - name: ðŸ“¥ Checkout du code
      uses: actions/checkout@v4
      
    - name: âš™ï¸ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: ðŸ“¦ Installation des dÃ©pendances
      run: npm install
      
    - name: ðŸ¤– GÃ©nÃ©ration du post LinkedIn
      env:
        GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
      run: npm run generate
      
    - name: ðŸ“ Affichage du rÃ©sultat
      run: |
        echo "ðŸ“„ Fichier gÃ©nÃ©rÃ© :"
        cat linkedin-post-for-n8n.json || echo "Fichier non trouvÃ©"
        echo ""
        echo "ðŸ“Š Statistiques du post :"
        if [ -f linkedin-post-for-n8n.json ]; then
          echo "Longueur du contenu: $(cat linkedin-post-for-n8n.json | jq -r '.post.content | length' 2>/dev/null || echo 'N/A') caractÃ¨res"
          echo "Nombre de hashtags: $(cat linkedin-post-for-n8n.json | jq -r '.post.hashtags | length' 2>/dev/null || echo 'N/A')"
          echo "Sujet: $(cat linkedin-post-for-n8n.json | jq -r '.post.topic' 2>/dev/null || echo 'N/A')"
        fi
        
    - name: ðŸ’¾ Commit des modifications
      uses: stefanzweifel/git-auto-commit-action@v4
      with:
        commit_message: "ðŸ¤– Auto-gÃ©nÃ©ration du post LinkedIn - $(date +'%Y-%m-%d %H:%M')"
        file_pattern: |
          data.json
          linkedin-post-for-n8n.json
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}